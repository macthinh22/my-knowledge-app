# Frontend Redesign — "Knowledge Gallery" Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Rebuild the entire frontend UI from generic centered layout to a visual-first "Knowledge Gallery" with shadcn/ui, full-width grid, list/grid toggle, filter toolbar, and split detail page.

**Architecture:** Replace all custom components with shadcn/ui primitives. Restructure layout from centered max-width to full-width with toolbar. Detail page moves from single-column to split layout (player left, tabbed content right). All business logic and API client stay unchanged.

**Tech Stack:** Next.js 16, React 19, Tailwind CSS v4, shadcn/ui (new-york style, lucide icons), react-markdown, remark-gfm.

---

### Task 1: Initialize shadcn/ui and install required components

**Files:**
- Create: `frontend/components.json`
- Create: `frontend/src/lib/utils.ts`
- Create: `frontend/src/components/ui/` (auto-generated by CLI)
- Modify: `frontend/package.json` (new dependencies)
- Modify: `frontend/src/app/globals.css` (shadcn CSS variables)

**Step 1: Initialize shadcn/ui**

Run from `frontend/` directory:

```bash
cd frontend && npx shadcn@latest init
```

Select these options:
- Style: new-york
- Base color: neutral
- CSS variables: yes
- RSC: yes (Next.js App Router)
- Icon library: lucide

This creates `components.json`, `src/lib/utils.ts`, and updates `globals.css` with shadcn CSS variables.

**Step 2: Install all needed shadcn components**

```bash
npx shadcn@latest add button input badge tabs accordion popover command dialog dropdown-menu skeleton separator tooltip
```

**Step 3: Install lucide-react icon library**

```bash
npm install lucide-react
```

**Step 4: Verify build passes**

```bash
npm run build
```

Expected: Build succeeds with no errors.

**Step 5: Commit**

```bash
git add -A && git commit -m "feat: initialize shadcn/ui with required components"
```

---

### Task 2: Replace globals.css with shadcn theming system

**Files:**
- Modify: `frontend/src/app/globals.css`

**Step 1: Rewrite globals.css**

Replace the entire file. Keep the Tailwind import and add shadcn's CSS variable system. Drop Source Serif 4, keep DM Sans. Use `class`-based dark mode (shadcn default) instead of `data-theme` attribute.

```css
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --font-sans: "DM Sans", ui-sans-serif, system-ui, sans-serif;
}

:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.965 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.965 0 0);
  --muted-foreground: oklch(0.455 0 0);
  --accent: oklch(0.965 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground font-sans antialiased;
  }
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/app/globals.css && git commit -m "feat: replace custom CSS variables with shadcn theming system"
```

---

### Task 3: Rebuild layout.tsx with class-based dark mode

**Files:**
- Modify: `frontend/src/app/layout.tsx`

**Step 1: Rewrite layout.tsx**

Replace the full file. Switch from `data-theme` to `class`-based dark mode. Remove Source Serif 4 font import, keep DM Sans. Remove the fixed-position ThemeToggle from here (it moves to the Toolbar in Task 4).

```tsx
import type { Metadata } from "next";
import { DM_Sans } from "next/font/google";
import "./globals.css";

const dmSans = DM_Sans({
  subsets: ["latin"],
  variable: "--font-sans",
});

export const metadata: Metadata = {
  title: "Knowledge Base",
  description: "Extract and organize knowledge from YouTube videos",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
      <head>
        <script
          dangerouslySetInnerHTML={{
            __html: `
              (function() {
                var theme = localStorage.getItem('theme');
                if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                  document.documentElement.classList.add('dark');
                }
              })();
            `,
          }}
        />
      </head>
      <body className={`${dmSans.variable} font-sans`}>
        {children}
      </body>
    </html>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/app/layout.tsx && git commit -m "feat: rebuild layout with class-based dark mode"
```

---

### Task 4: Build Toolbar component (search, filters, view toggle, theme)

**Files:**
- Create: `frontend/src/components/Toolbar.tsx`
- Create: `frontend/src/components/ThemeToggle.tsx` (rewrite)
- Create: `frontend/src/components/ViewToggle.tsx`

**Step 1: Create ThemeToggle component**

Rewrite using lucide icons and shadcn Button. Switch from `data-theme` to `class`-based.

```tsx
"use client";

import { useEffect, useState } from "react";
import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";

export function ThemeToggle() {
  const [dark, setDark] = useState(false);

  useEffect(() => {
    setDark(document.documentElement.classList.contains("dark"));
  }, []);

  function toggle() {
    const next = !dark;
    setDark(next);
    document.documentElement.classList.toggle("dark", next);
    localStorage.setItem("theme", next ? "dark" : "light");
  }

  return (
    <Button variant="ghost" size="icon" onClick={toggle} aria-label="Toggle theme">
      {dark ? <Sun className="h-4 w-4" /> : <Moon className="h-4 w-4" />}
    </Button>
  );
}
```

**Step 2: Create ViewToggle component**

```tsx
"use client";

import { LayoutGrid, List } from "lucide-react";
import { Button } from "@/components/ui/button";

interface ViewToggleProps {
  view: "grid" | "list";
  onViewChange: (view: "grid" | "list") => void;
}

export function ViewToggle({ view, onViewChange }: ViewToggleProps) {
  return (
    <div className="flex items-center rounded-md border border-border">
      <Button
        variant={view === "grid" ? "secondary" : "ghost"}
        size="icon"
        className="h-8 w-8 rounded-r-none"
        onClick={() => onViewChange("grid")}
        aria-label="Grid view"
      >
        <LayoutGrid className="h-4 w-4" />
      </Button>
      <Button
        variant={view === "list" ? "secondary" : "ghost"}
        size="icon"
        className="h-8 w-8 rounded-l-none"
        onClick={() => onViewChange("list")}
        aria-label="List view"
      >
        <List className="h-4 w-4" />
      </Button>
    </div>
  );
}
```

**Step 3: Create Toolbar component**

```tsx
"use client";

import { useState, useCallback, useEffect, useRef } from "react";
import { Search, X, BookOpen } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { ThemeToggle } from "./ThemeToggle";
import { ViewToggle } from "./ViewToggle";

interface ToolbarProps {
  onSearchChange: (query: string) => void;
  view: "grid" | "list";
  onViewChange: (view: "grid" | "list") => void;
  availableKeywords?: string[];
  selectedKeywords?: string[];
  onKeywordsChange?: (keywords: string[]) => void;
}

export function Toolbar({
  onSearchChange,
  view,
  onViewChange,
  availableKeywords = [],
  selectedKeywords = [],
  onKeywordsChange,
}: ToolbarProps) {
  const [query, setQuery] = useState("");
  const debounceRef = useRef<ReturnType<typeof setTimeout>>(null);

  const handleChange = useCallback(
    (value: string) => {
      setQuery(value);
      if (debounceRef.current) clearTimeout(debounceRef.current);
      debounceRef.current = setTimeout(() => onSearchChange(value), 250);
    },
    [onSearchChange],
  );

  useEffect(() => {
    return () => {
      if (debounceRef.current) clearTimeout(debounceRef.current);
    };
  }, []);

  function toggleKeyword(kw: string) {
    if (!onKeywordsChange) return;
    if (selectedKeywords.includes(kw)) {
      onKeywordsChange(selectedKeywords.filter((k) => k !== kw));
    } else {
      onKeywordsChange([...selectedKeywords, kw]);
    }
  }

  return (
    <header className="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="flex h-14 items-center gap-4 px-6">
        <div className="flex items-center gap-2 font-semibold">
          <BookOpen className="h-5 w-5" />
          <span className="hidden sm:inline">Knowledge Base</span>
        </div>

        <div className="relative flex-1 max-w-md mx-auto">
          <Search className="absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
          <Input
            type="search"
            placeholder="Search videos..."
            className="pl-9 pr-9"
            value={query}
            onChange={(e) => handleChange(e.target.value)}
          />
          {query && (
            <Button
              variant="ghost"
              size="icon"
              className="absolute right-1 top-1/2 -translate-y-1/2 h-6 w-6"
              onClick={() => handleChange("")}
            >
              <X className="h-3 w-3" />
            </Button>
          )}
        </div>

        <div className="flex items-center gap-2">
          <ViewToggle view={view} onViewChange={onViewChange} />
          <ThemeToggle />
        </div>
      </div>

      {availableKeywords.length > 0 && (
        <div className="flex items-center gap-2 px-6 pb-3 overflow-x-auto">
          {availableKeywords.slice(0, 15).map((kw) => (
            <Badge
              key={kw}
              variant={selectedKeywords.includes(kw) ? "default" : "outline"}
              className="cursor-pointer whitespace-nowrap"
              onClick={() => toggleKeyword(kw)}
            >
              {kw}
            </Badge>
          ))}
        </div>
      )}
    </header>
  );
}
```

**Step 4: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 5: Commit**

```bash
git add src/components/Toolbar.tsx src/components/ThemeToggle.tsx src/components/ViewToggle.tsx && git commit -m "feat: add Toolbar with search, keyword filters, view toggle, and theme toggle"
```

---

### Task 5: Build VideoCard (grid) and VideoListItem (list) components

**Files:**
- Modify: `frontend/src/components/VideoCard.tsx` (rewrite)
- Create: `frontend/src/components/VideoListItem.tsx`

**Step 1: Rewrite VideoCard for grid view**

Large thumbnail with overlay badges, no borders, shadow-based elevation.

```tsx
import Link from "next/link";
import Image from "next/image";
import { Clock, Play } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import type { VideoListItem as VideoType } from "@/lib/api";

interface VideoCardProps {
  video: VideoType;
}

export function VideoCard({ video }: VideoCardProps) {
  const thumbnail = `https://i.ytimg.com/vi/${video.youtube_id}/hqdefault.jpg`;

  return (
    <Link href={`/video/${video.id}`} className="group block">
      <div className="overflow-hidden rounded-lg bg-card shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-0.5">
        <div className="relative aspect-video overflow-hidden">
          <Image
            src={thumbnail}
            alt={video.title}
            fill
            className="object-cover transition-transform duration-200 group-hover:scale-105"
            sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
          />
          {video.duration && (
            <span className="absolute bottom-2 right-2 flex items-center gap-1 rounded bg-black/80 px-1.5 py-0.5 text-xs font-medium text-white">
              <Clock className="h-3 w-3" />
              {video.duration}
            </span>
          )}
          <div className="absolute inset-0 flex items-center justify-center bg-black/0 transition-colors group-hover:bg-black/10">
            <Play className="h-10 w-10 text-white opacity-0 transition-opacity group-hover:opacity-80" fill="white" />
          </div>
        </div>

        <div className="p-3">
          <h3 className="line-clamp-2 text-sm font-medium leading-snug">
            {video.title}
          </h3>
          <p className="mt-1 text-xs text-muted-foreground">
            {video.channel_name}
          </p>
          <p className="text-xs text-muted-foreground">
            {new Date(video.published_at).toLocaleDateString()}
          </p>
          {video.keywords && video.keywords.length > 0 && (
            <div className="mt-2 flex flex-wrap gap-1">
              {video.keywords.slice(0, 3).map((kw) => (
                <Badge key={kw} variant="secondary" className="text-[10px] px-1.5 py-0">
                  {kw}
                </Badge>
              ))}
              {video.keywords.length > 3 && (
                <span className="text-[10px] text-muted-foreground self-center">
                  +{video.keywords.length - 3}
                </span>
              )}
            </div>
          )}
        </div>
      </div>
    </Link>
  );
}
```

**Step 2: Create VideoListItem component**

```tsx
import Link from "next/link";
import Image from "next/image";
import { Clock } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import type { VideoListItem as VideoType } from "@/lib/api";

interface VideoListItemProps {
  video: VideoType;
}

export function VideoListItem({ video }: VideoListItemProps) {
  const thumbnail = `https://i.ytimg.com/vi/${video.youtube_id}/hqdefault.jpg`;

  return (
    <Link
      href={`/video/${video.id}`}
      className="group flex gap-4 rounded-lg p-2 transition-colors hover:bg-accent"
    >
      <div className="relative h-20 w-36 shrink-0 overflow-hidden rounded-md">
        <Image
          src={thumbnail}
          alt={video.title}
          fill
          className="object-cover"
          sizes="160px"
        />
        {video.duration && (
          <span className="absolute bottom-1 right-1 flex items-center gap-0.5 rounded bg-black/80 px-1 py-0.5 text-[10px] font-medium text-white">
            <Clock className="h-2.5 w-2.5" />
            {video.duration}
          </span>
        )}
      </div>

      <div className="flex flex-1 flex-col justify-center min-w-0">
        <h3 className="truncate text-sm font-medium">{video.title}</h3>
        <p className="text-xs text-muted-foreground">
          {video.channel_name} &middot; {new Date(video.published_at).toLocaleDateString()}
        </p>
        {video.keywords && video.keywords.length > 0 && (
          <div className="mt-1 flex flex-wrap gap-1">
            {video.keywords.slice(0, 4).map((kw) => (
              <Badge key={kw} variant="secondary" className="text-[10px] px-1.5 py-0">
                {kw}
              </Badge>
            ))}
          </div>
        )}
      </div>
    </Link>
  );
}
```

**Step 3: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 4: Commit**

```bash
git add src/components/VideoCard.tsx src/components/VideoListItem.tsx && git commit -m "feat: rebuild VideoCard and add VideoListItem for grid/list views"
```

---

### Task 6: Build VideoInput with shadcn components

**Files:**
- Modify: `frontend/src/components/VideoInput.tsx` (rewrite)

**Step 1: Rewrite VideoInput**

Use shadcn Input + Button. Keep the YouTube URL validation regex and existing onSubmit logic.

```tsx
"use client";

import { useState } from "react";
import { Link2, Loader2 } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";

interface VideoInputProps {
  onSubmit: (url: string) => void;
  isLoading: boolean;
}

const YOUTUBE_REGEX =
  /^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)[\w-]+/;

export function VideoInput({ onSubmit, isLoading }: VideoInputProps) {
  const [url, setUrl] = useState("");
  const [error, setError] = useState("");

  function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
    const trimmed = url.trim();
    if (!trimmed) return;
    if (!YOUTUBE_REGEX.test(trimmed)) {
      setError("Please enter a valid YouTube URL");
      return;
    }
    setError("");
    onSubmit(trimmed);
    setUrl("");
  }

  return (
    <form onSubmit={handleSubmit} className="flex gap-2">
      <div className="relative flex-1">
        <Link2 className="absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
        <Input
          type="url"
          placeholder="Paste a YouTube URL..."
          className="pl-9"
          value={url}
          onChange={(e) => {
            setUrl(e.target.value);
            if (error) setError("");
          }}
          disabled={isLoading}
        />
      </div>
      <Button type="submit" disabled={isLoading || !url.trim()}>
        {isLoading ? (
          <>
            <Loader2 className="mr-2 h-4 w-4 animate-spin" />
            Extracting...
          </>
        ) : (
          "Extract"
        )}
      </Button>
      {error && (
        <p className="absolute mt-11 text-xs text-destructive">{error}</p>
      )}
    </form>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/components/VideoInput.tsx && git commit -m "feat: rebuild VideoInput with shadcn Input and Button"
```

---

### Task 7: Rebuild Home page with full-width layout, grid/list toggle, and Toolbar

**Files:**
- Modify: `frontend/src/app/page.tsx` (rewrite)

**Step 1: Rewrite the home page**

Full-width layout. Toolbar at top. VideoInput in a centered area below toolbar. Grid/list toggle with keyword filtering. Remove the hero section — the toolbar IS the navigation now.

```tsx
"use client";

import { useCallback, useEffect, useMemo, useState } from "react";
import { Plus, VideoOff, SearchX } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Skeleton } from "@/components/ui/skeleton";
import { Toolbar } from "@/components/Toolbar";
import { VideoInput } from "@/components/VideoInput";
import { VideoCard } from "@/components/VideoCard";
import { VideoListItem } from "@/components/VideoListItem";
import { LoadingState } from "@/components/LoadingState";
import { listVideos, createVideo, type VideoListItem as VideoType } from "@/lib/api";

export default function HomePage() {
  const [videos, setVideos] = useState<VideoType[]>([]);
  const [loading, setLoading] = useState(true);
  const [extracting, setExtracting] = useState(false);
  const [error, setError] = useState("");
  const [search, setSearch] = useState("");
  const [view, setView] = useState<"grid" | "list">("grid");
  const [selectedKeywords, setSelectedKeywords] = useState<string[]>([]);
  const [showInput, setShowInput] = useState(false);

  useEffect(() => {
    listVideos()
      .then(setVideos)
      .catch(() => setError("Failed to load videos"))
      .finally(() => setLoading(false));
  }, []);

  const allKeywords = useMemo(() => {
    const counts = new Map<string, number>();
    videos.forEach((v) =>
      v.keywords?.forEach((kw) => counts.set(kw, (counts.get(kw) || 0) + 1)),
    );
    return [...counts.entries()]
      .sort((a, b) => b[1] - a[1])
      .map(([kw]) => kw);
  }, [videos]);

  const filtered = useMemo(() => {
    let result = videos;
    if (search) {
      const q = search.toLowerCase();
      result = result.filter(
        (v) =>
          v.title.toLowerCase().includes(q) ||
          v.channel_name?.toLowerCase().includes(q) ||
          v.keywords?.some((kw) => kw.toLowerCase().includes(q)),
      );
    }
    if (selectedKeywords.length > 0) {
      result = result.filter((v) =>
        selectedKeywords.every((kw) => v.keywords?.includes(kw)),
      );
    }
    return result;
  }, [videos, search, selectedKeywords]);

  const handleExtract = useCallback(async (url: string) => {
    setExtracting(true);
    setError("");
    try {
      await createVideo(url);
      const updated = await listVideos();
      setVideos(updated);
      setShowInput(false);
    } catch (e: unknown) {
      const msg = e instanceof Error ? e.message : "Failed to extract video";
      setError(msg);
    } finally {
      setExtracting(false);
    }
  }, []);

  return (
    <div className="min-h-screen bg-background">
      <Toolbar
        onSearchChange={setSearch}
        view={view}
        onViewChange={setView}
        availableKeywords={allKeywords}
        selectedKeywords={selectedKeywords}
        onKeywordsChange={setSelectedKeywords}
      />

      <main className="px-6 py-6">
        {/* Add video section */}
        <div className="mb-6 flex items-center justify-between">
          <div>
            <h1 className="text-lg font-semibold">
              {filtered.length} video{filtered.length !== 1 ? "s" : ""}
            </h1>
            {error && <p className="text-sm text-destructive">{error}</p>}
          </div>
          {!showInput && (
            <Button onClick={() => setShowInput(true)}>
              <Plus className="mr-2 h-4 w-4" />
              Add Video
            </Button>
          )}
        </div>

        {showInput && (
          <div className="mb-6 max-w-xl">
            <VideoInput onSubmit={handleExtract} isLoading={extracting} />
          </div>
        )}

        {extracting && <LoadingState />}

        {/* Loading skeleton */}
        {loading && (
          <div className="grid grid-cols-[repeat(auto-fill,minmax(280px,1fr))] gap-4">
            {Array.from({ length: 6 }).map((_, i) => (
              <div key={i} className="space-y-3">
                <Skeleton className="aspect-video w-full rounded-lg" />
                <Skeleton className="h-4 w-3/4" />
                <Skeleton className="h-3 w-1/2" />
              </div>
            ))}
          </div>
        )}

        {/* Empty states */}
        {!loading && videos.length === 0 && (
          <div className="flex flex-col items-center justify-center py-20 text-center">
            <VideoOff className="h-12 w-12 text-muted-foreground mb-4" />
            <h2 className="text-lg font-medium">No videos yet</h2>
            <p className="text-sm text-muted-foreground mt-1 mb-4">
              Add your first YouTube video to start building your knowledge base.
            </p>
            {!showInput && (
              <Button onClick={() => setShowInput(true)}>
                <Plus className="mr-2 h-4 w-4" />
                Add Video
              </Button>
            )}
          </div>
        )}

        {!loading && videos.length > 0 && filtered.length === 0 && (
          <div className="flex flex-col items-center justify-center py-20 text-center">
            <SearchX className="h-12 w-12 text-muted-foreground mb-4" />
            <h2 className="text-lg font-medium">No matches</h2>
            <p className="text-sm text-muted-foreground mt-1">
              Try a different search term or clear your filters.
            </p>
          </div>
        )}

        {/* Video grid/list */}
        {!loading && filtered.length > 0 && view === "grid" && (
          <div className="grid grid-cols-[repeat(auto-fill,minmax(280px,1fr))] gap-4">
            {filtered.map((video) => (
              <VideoCard key={video.id} video={video} />
            ))}
          </div>
        )}

        {!loading && filtered.length > 0 && view === "list" && (
          <div className="space-y-1">
            {filtered.map((video) => (
              <VideoListItem key={video.id} video={video} />
            ))}
          </div>
        )}
      </main>
    </div>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/app/page.tsx && git commit -m "feat: rebuild home page with full-width layout, grid/list toggle, and toolbar"
```

---

### Task 8: Rebuild VideoDetail with tabbed accordion layout

**Files:**
- Modify: `frontend/src/components/VideoDetail.tsx` (rewrite)

**Step 1: Rewrite VideoDetail**

Use shadcn Tabs and Accordion. Two tabs: Analysis (4 collapsible sections) and Notes.

```tsx
"use client";

import ReactMarkdown from "react-markdown";
import remarkGfm from "remark-gfm";
import { BookOpen, Lightbulb, AlertTriangle, Globe } from "lucide-react";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";
import type { Video } from "@/lib/api";
import { NotesEditor } from "./NotesEditor";

interface VideoDetailProps {
  video: Video;
}

const sections = [
  { key: "explanation", label: "Explanation", icon: BookOpen, field: "explanation" as const },
  { key: "key_knowledge", label: "Key Knowledge", icon: Lightbulb, field: "key_knowledge" as const },
  { key: "critical_analysis", label: "Critical Analysis", icon: AlertTriangle, field: "critical_analysis" as const },
  { key: "applications", label: "Real-World Applications", icon: Globe, field: "applications" as const },
];

export function VideoDetail({ video }: VideoDetailProps) {
  const activeSections = sections.filter((s) => video[s.field]);

  return (
    <Tabs defaultValue="analysis" className="h-full">
      <TabsList className="w-full">
        <TabsTrigger value="analysis" className="flex-1">Analysis</TabsTrigger>
        <TabsTrigger value="notes" className="flex-1">Notes</TabsTrigger>
      </TabsList>

      <TabsContent value="analysis" className="mt-4">
        {activeSections.length === 0 ? (
          <p className="text-sm text-muted-foreground py-8 text-center">
            No analysis available for this video.
          </p>
        ) : (
          <Accordion type="multiple" defaultValue={activeSections.map((s) => s.key)}>
            {activeSections.map((section) => {
              const Icon = section.icon;
              return (
                <AccordionItem key={section.key} value={section.key}>
                  <AccordionTrigger className="text-sm font-medium">
                    <span className="flex items-center gap-2">
                      <Icon className="h-4 w-4" />
                      {section.label}
                    </span>
                  </AccordionTrigger>
                  <AccordionContent>
                    <div className="prose prose-sm dark:prose-invert max-w-none">
                      <ReactMarkdown remarkPlugins={[remarkGfm]}>
                        {video[section.field] || ""}
                      </ReactMarkdown>
                    </div>
                  </AccordionContent>
                </AccordionItem>
              );
            })}
          </Accordion>
        )}
      </TabsContent>

      <TabsContent value="notes" className="mt-4">
        <NotesEditor videoId={video.id} initialNotes={video.notes || ""} />
      </TabsContent>
    </Tabs>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/components/VideoDetail.tsx && git commit -m "feat: rebuild VideoDetail with shadcn Tabs and Accordion"
```

---

### Task 9: Rebuild NotesEditor with shadcn styling

**Files:**
- Modify: `frontend/src/components/NotesEditor.tsx` (rewrite)

**Step 1: Rewrite NotesEditor**

Keep auto-save logic, use shadcn-compatible styling.

```tsx
"use client";

import { useState, useCallback, useRef } from "react";
import { Save, Loader2, Check, AlertCircle } from "lucide-react";
import { updateVideoNotes } from "@/lib/api";

interface NotesEditorProps {
  videoId: number;
  initialNotes: string;
}

export function NotesEditor({ videoId, initialNotes }: NotesEditorProps) {
  const [notes, setNotes] = useState(initialNotes);
  const [status, setStatus] = useState<"idle" | "saving" | "saved" | "error">("idle");
  const timeoutRef = useRef<ReturnType<typeof setTimeout>>(null);

  const save = useCallback(async () => {
    setStatus("saving");
    try {
      await updateVideoNotes(videoId, notes);
      setStatus("saved");
      if (timeoutRef.current) clearTimeout(timeoutRef.current);
      timeoutRef.current = setTimeout(() => setStatus("idle"), 2500);
    } catch {
      setStatus("error");
    }
  }, [videoId, notes]);

  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <label htmlFor="notes" className="text-sm font-medium">
          Personal Notes
        </label>
        <span className="flex items-center gap-1 text-xs text-muted-foreground">
          {status === "saving" && <><Loader2 className="h-3 w-3 animate-spin" /> Saving...</>}
          {status === "saved" && <><Check className="h-3 w-3 text-green-500" /> Saved</>}
          {status === "error" && <><AlertCircle className="h-3 w-3 text-destructive" /> Failed to save</>}
          {status === "idle" && <><Save className="h-3 w-3" /> Auto-saves on blur</>}
        </span>
      </div>
      <textarea
        id="notes"
        className="min-h-[200px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring resize-y"
        placeholder="Write your notes about this video..."
        value={notes}
        onChange={(e) => setNotes(e.target.value)}
        onBlur={save}
      />
    </div>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/components/NotesEditor.tsx && git commit -m "feat: rebuild NotesEditor with shadcn styling"
```

---

### Task 10: Rebuild DeleteButton with shadcn Dialog

**Files:**
- Modify: `frontend/src/components/DeleteButton.tsx` (rewrite)

**Step 1: Rewrite DeleteButton**

Replace custom modal with shadcn Dialog.

```tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { Trash2, Loader2 } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { deleteVideo } from "@/lib/api";

interface DeleteButtonProps {
  videoId: number;
  videoTitle: string;
}

export function DeleteButton({ videoId, videoTitle }: DeleteButtonProps) {
  const router = useRouter();
  const [open, setOpen] = useState(false);
  const [deleting, setDeleting] = useState(false);

  async function handleDelete() {
    setDeleting(true);
    try {
      await deleteVideo(videoId);
      router.push("/");
    } catch {
      setDeleting(false);
    }
  }

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button variant="ghost" size="sm" className="text-destructive hover:text-destructive">
          <Trash2 className="mr-2 h-4 w-4" />
          Delete
        </Button>
      </DialogTrigger>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Delete video?</DialogTitle>
          <DialogDescription>
            This will permanently delete &ldquo;{videoTitle}&rdquo; and all associated notes and analysis. This action cannot be undone.
          </DialogDescription>
        </DialogHeader>
        <DialogFooter>
          <Button variant="outline" onClick={() => setOpen(false)} disabled={deleting}>
            Cancel
          </Button>
          <Button variant="destructive" onClick={handleDelete} disabled={deleting}>
            {deleting ? (
              <><Loader2 className="mr-2 h-4 w-4 animate-spin" /> Deleting...</>
            ) : (
              "Delete"
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/components/DeleteButton.tsx && git commit -m "feat: rebuild DeleteButton with shadcn Dialog"
```

---

### Task 11: Rebuild LoadingState with shadcn Skeleton

**Files:**
- Modify: `frontend/src/components/LoadingState.tsx` (rewrite)

**Step 1: Rewrite LoadingState**

Replace custom modal with shadcn Dialog and progress steps.

```tsx
"use client";

import { useEffect, useState } from "react";
import { Loader2, Check } from "lucide-react";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";

const steps = [
  "Fetching video information",
  "Downloading audio",
  "Transcribing content",
  "Analyzing knowledge",
];

export function LoadingState() {
  const [currentStep, setCurrentStep] = useState(0);

  useEffect(() => {
    const interval = setInterval(() => {
      setCurrentStep((prev) => (prev < steps.length - 1 ? prev + 1 : prev));
    }, 4000);
    return () => clearInterval(interval);
  }, []);

  return (
    <Dialog open>
      <DialogContent className="sm:max-w-sm" onInteractOutside={(e) => e.preventDefault()}>
        <DialogHeader>
          <DialogTitle>Extracting Knowledge</DialogTitle>
        </DialogHeader>
        <div className="space-y-3 py-2">
          {steps.map((step, i) => (
            <div key={step} className="flex items-center gap-3 text-sm">
              {i < currentStep ? (
                <Check className="h-4 w-4 text-green-500 shrink-0" />
              ) : i === currentStep ? (
                <Loader2 className="h-4 w-4 animate-spin text-primary shrink-0" />
              ) : (
                <div className="h-4 w-4 rounded-full border border-border shrink-0" />
              )}
              <span className={i > currentStep ? "text-muted-foreground" : ""}>
                {step}
              </span>
            </div>
          ))}
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/components/LoadingState.tsx && git commit -m "feat: rebuild LoadingState with shadcn Dialog and step tracker"
```

---

### Task 12: Rebuild video detail page with split layout

**Files:**
- Modify: `frontend/src/app/video/[id]/page.tsx` (rewrite)

**Step 1: Rewrite the video detail page**

Split layout: sticky player left (60%), tabbed content right (40%). Responsive — stacks on mobile.

```tsx
"use client";

import { useEffect, useState, use } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { ArrowLeft, Clock, Calendar } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Skeleton } from "@/components/ui/skeleton";
import { Separator } from "@/components/ui/separator";
import { YouTubeEmbed } from "@/components/YouTubeEmbed";
import { VideoDetail } from "@/components/VideoDetail";
import { DeleteButton } from "@/components/DeleteButton";
import { getVideo, type Video } from "@/lib/api";

export default function VideoPage({
  params,
}: {
  params: Promise<{ id: string }>;
}) {
  const { id } = use(params);
  const router = useRouter();
  const [video, setVideo] = useState<Video | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");

  useEffect(() => {
    getVideo(Number(id))
      .then(setVideo)
      .catch(() => setError("Failed to load video"))
      .finally(() => setLoading(false));
  }, [id]);

  if (loading) {
    return (
      <div className="min-h-screen bg-background p-6">
        <Skeleton className="h-6 w-32 mb-6" />
        <div className="flex flex-col lg:flex-row gap-6">
          <div className="lg:w-3/5">
            <Skeleton className="aspect-video w-full rounded-lg" />
            <Skeleton className="mt-4 h-6 w-3/4" />
            <Skeleton className="mt-2 h-4 w-1/2" />
          </div>
          <div className="lg:w-2/5 space-y-4">
            <Skeleton className="h-10 w-full" />
            <Skeleton className="h-40 w-full" />
          </div>
        </div>
      </div>
    );
  }

  if (error || !video) {
    return (
      <div className="flex min-h-screen flex-col items-center justify-center bg-background">
        <p className="text-destructive mb-4">{error || "Video not found"}</p>
        <Button variant="outline" onClick={() => router.push("/")}>
          Back to library
        </Button>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background">
      <div className="border-b border-border px-6 py-3">
        <Link
          href="/"
          className="inline-flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground transition-colors"
        >
          <ArrowLeft className="h-4 w-4" />
          Back to library
        </Link>
      </div>

      <div className="flex flex-col lg:flex-row gap-6 p-6">
        {/* Left panel - player + metadata */}
        <div className="lg:w-3/5">
          <div className="lg:sticky lg:top-6">
            <YouTubeEmbed youtubeId={video.youtube_id} title={video.title} />

            <div className="mt-4">
              <h1 className="text-xl font-semibold">{video.title}</h1>
              <div className="mt-2 flex flex-wrap items-center gap-3 text-sm text-muted-foreground">
                {video.channel_name && <span>{video.channel_name}</span>}
                {video.duration && (
                  <span className="flex items-center gap-1">
                    <Clock className="h-3.5 w-3.5" />
                    {video.duration}
                  </span>
                )}
                {video.published_at && (
                  <span className="flex items-center gap-1">
                    <Calendar className="h-3.5 w-3.5" />
                    {new Date(video.published_at).toLocaleDateString()}
                  </span>
                )}
              </div>

              {video.keywords && video.keywords.length > 0 && (
                <div className="mt-3 flex flex-wrap gap-1.5">
                  {video.keywords.map((kw) => (
                    <Badge key={kw} variant="secondary">
                      {kw}
                    </Badge>
                  ))}
                </div>
              )}

              <Separator className="my-4" />

              <DeleteButton videoId={video.id} videoTitle={video.title} />
            </div>
          </div>
        </div>

        {/* Right panel - analysis + notes */}
        <div className="lg:w-2/5">
          <VideoDetail video={video} />
        </div>
      </div>
    </div>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/app/video/\\[id\\]/page.tsx && git commit -m "feat: rebuild video detail page with split layout"
```

---

### Task 13: Update YouTubeEmbed with clean styling

**Files:**
- Modify: `frontend/src/components/YouTubeEmbed.tsx` (rewrite)

**Step 1: Rewrite YouTubeEmbed**

Clean, borderless embed with proper aspect ratio.

```tsx
interface YouTubeEmbedProps {
  youtubeId: string;
  title: string;
}

export function YouTubeEmbed({ youtubeId, title }: YouTubeEmbedProps) {
  return (
    <div className="aspect-video w-full overflow-hidden rounded-lg bg-muted">
      <iframe
        src={`https://www.youtube-nocookie.com/embed/${youtubeId}`}
        title={title}
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowFullScreen
        loading="lazy"
        className="h-full w-full"
      />
    </div>
  );
}
```

**Step 2: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 3: Commit**

```bash
git add src/components/YouTubeEmbed.tsx && git commit -m "feat: simplify YouTubeEmbed styling"
```

---

### Task 14: Clean up unused files and add prose styles

**Files:**
- Delete: `frontend/src/components/SearchBar.tsx` (absorbed into Toolbar)
- Delete: `frontend/src/components/KeywordBadge.tsx` (replaced by shadcn Badge)
- Modify: `frontend/src/app/globals.css` (add Tailwind prose plugin styles)
- Modify: `frontend/src/app/not-found.tsx` (update to match new design)

**Step 1: Delete unused components**

```bash
cd frontend && rm src/components/SearchBar.tsx src/components/KeywordBadge.tsx
```

**Step 2: Install Tailwind typography plugin for prose styles**

```bash
npm install @tailwindcss/typography
```

Add to `globals.css` after the tailwindcss import:

```css
@import "tailwindcss";
@import "@tailwindcss/typography";
```

**Step 3: Update not-found.tsx**

```tsx
import Link from "next/link";

export default function NotFound() {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-background">
      <h1 className="text-4xl font-bold">404</h1>
      <p className="mt-2 text-muted-foreground">Page not found</p>
      <Link
        href="/"
        className="mt-4 text-sm text-primary underline-offset-4 hover:underline"
      >
        Back to library
      </Link>
    </div>
  );
}
```

**Step 4: Verify build passes**

```bash
cd frontend && npm run build
```

**Step 5: Commit**

```bash
git add -A && git commit -m "feat: clean up unused components, add typography plugin, update 404 page"
```

---

### Task 15: Visual QA and final polish

**Files:**
- Potentially any component file for minor tweaks

**Step 1: Run the dev server**

```bash
cd frontend && npm run dev
```

**Step 2: Verify all pages visually**

Check with Playwright or manual inspection:
- Home page: toolbar renders, grid/list toggle works, keyword filters work, search works
- Add video flow: input appears, validation works, loading modal shows
- Video detail: split layout renders, tabs work, accordion works, notes save, delete dialog works
- Dark mode: toggle works, all components respect theme
- Responsive: check at mobile (375px), tablet (768px), desktop (1280px+)

**Step 3: Fix any visual issues found**

Adjust spacing, colors, or typography as needed.

**Step 4: Final commit**

```bash
git add -A && git commit -m "fix: visual QA polish and adjustments"
```
